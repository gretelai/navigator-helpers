{"id":5097,"domain":"forestry","domain_description":"Comprehensive data on sustainable forest management, timber production, wildlife habitat, and carbon sequestration in forestry.","sql_complexity":"single join","sql_complexity_description":"only one join (specify inner, outer, cross)","sql_task_type":"analytics and reporting","sql_task_type_description":"generating reports, dashboards, and analytical insights","sql_prompt":"What is the total volume of timber sold by each salesperson, sorted by salesperson, considering only sales made by salespeople who have sold more than 150 cubic meters of total timber in the North region, and excluding sales made in the first or third quarter of the year, while also accounting for the 10% discount applied to all sales made in the second or fourth quarter, and further aggregating the results by region?","sql_context":"CREATE TABLE salesperson (salesperson_id INT, name TEXT, region TEXT); INSERT INTO salesperson (salesperson_id, name, region) VALUES (1, 'John Doe', 'North'), (2, 'Jane Smith', 'South'); CREATE TABLE timber_sales (sales_id INT, salesperson_id INT, volume REAL, sale_date DATE); INSERT INTO timber_sales (sales_id, salesperson_id, volume, sale_date) VALUES (1, 1, 120, '2021-01-01'), (2, 1, 150, '2021-02-01'), (3, 2, 180, '2021-01-01');","sql":"WITH sales AS (\n    SELECT \n        s.salesperson_id, \n        s.name, \n        SUM(t.volume * (CASE WHEN EXTRACT(QUARTER FROM t.sale_date) IN (2, 4) THEN 0.9 ELSE 1 END)) OVER (PARTITION BY s.salesperson_id, EXTRACT(YEAR FROM t.sale_date)) AS total_volume\n    FROM \n        timber_sales t \n    JOIN \n        salesperson s ON t.salesperson_id = s.salesperson_id \n    WHERE \n        s.region = 'North' \n        AND t.volume > 150 \n        AND EXTRACT(QUARTER FROM t.sale_date) NOT IN (1, 3)\n    QUALIFY ROW_NUMBER() OVER (PARTITION BY s.salesperson_id, EXTRACT(YEAR FROM t.sale_date) ORDER BY SUM(t.volume * (CASE WHEN EXTRACT(QUARTER FROM t.sale_date) IN (2, 4) THEN 0.9 ELSE 1 END)) DESC) = 1\n)\nSELECT \n    s.region, \n    s.name, \n    SUM(s.total_volume) AS total_volume\nFROM \n    sales s\nGROUP BY \n    s.region, \n    s.name\nORDER BY \n    s.region, \n    total_volume DESC;","sql_explanation":"Joins timber_sales and salesperson tables, groups sales by salesperson, calculates total volume sold by each salesperson, and orders the results by total volume in descending order.","sql_prompt_score":95.0,"sql_score":94.2857142857}
